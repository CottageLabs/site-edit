postgres:
  build: ./docker-postgres
  restart: always

  ports:
    - 32345:5432

  volumes:
    - ./volumes/postgres:/var/lib/postgresql/data

rabbitmq:
  image: rabbitmq:3-alpine

php:
  build: ./emlo-edit-php
  restart: always

  ports:
    - 8080:80

  links:
    - postgres
    - rabbitmq
    - uploadermongo

  env_file:
    - docker-compose.php.env

  volumes:
    -  ./docker-exporter/exporter/exports:/var/www/html/exports
    -  ./docker-exporter/exporter/exporter_data:/var/www/exporter/exporter_data

    - ./volumes/csv:/csv
    - ./volumes/ssh:/root/.ssh

    - ./volumes/uploader:/uploader

exporter:
  build: ./docker-exporter
  restart: always

  links:
    - postgres

  volumes:
    -  ./docker-exporter/exporter/exports:/usr/src/app/exports
    -  ./docker-exporter/exporter/exporter_data:/usr/src/app/exporter_data

uploader:
  build: ./docker-uploader
  restart: always

  links:
    - postgres
    - rabbitmq
    - uploadermongo

  volumes:
    - ./volumes/uploader:/uploader

uploadermongo:
  image: mongo
  restart: always

nginx:
  build: ./nginx
  restart: always

  links:
    - php

  volumes:
    -  ./volumes/static:/static

  ports:
    - 80:80
    - 443:443
    - 3000:3000